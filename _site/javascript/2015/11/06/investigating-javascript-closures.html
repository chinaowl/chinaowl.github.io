<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="I was looking up JavaScript closures this morning and came across this terrific Stack Overflow answer (the first one with all the examples).">

    <title>Investigating JavaScript closures</title>
    
    <link rel="stylesheet" href=" /assets/css/main.css ">
    <link rel="canonical" href="http://chinaowl.co/javascript/2015/11/06/investigating-javascript-closures.html">
    <link rel="alternate" type="application/rss+xml" title="China Wang" href="http://chinaowl.co /feed.xml ">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather|Pacifico|Source+Code+Pro">
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
</head>

<body>
  <div class=wrapper>
    <header>
  <a href="/">
    <div class="header">
      China Wang
    </div>
  </a>
  <ul class="nav">
    <a href="/writing">
      <li class="nav__item">Writing</li>
    </a> |
    <a href="/projects">
      <li class="nav__item">Projects</li>
    </a>
  </ul>
</header>
    <div class="content">
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Investigating JavaScript closures</h1>
    <p class="post-meta"><time datetime="2015-11-06T00:00:00-08:00" itemprop="datePublished">November 6, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>I was looking up JavaScript closures this morning and came across this <a href="http://stackoverflow.com/questions/111102/how-do-javascript-closures-work">terrific Stack Overflow answer</a> (the first one with all the examples).</p>

<p>But, one of the examples (#5) confused me so I decided to take a closer look at it. Here’s the code, taken directly from SO with a little bit of formatting:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>function buildList(list) {
    var result = [];
    for (var i = 0; i &lt; list.length; i++) {
        var item = 'item' + i;
        result.push(function() {
            alert(item + ' ' + list[i])
        });
    }
    return result;
}

function testList() {
    var fnlist = buildList([1,2,3]);
    // Using j only to help prevent confusion -- could use i.
    for (var j = 0; j &lt; fnlist.length; j++) {
        fnlist[j]();
    }
}
`&lt;/pre&gt;

When I ran the code in the console, calling `testList()`, I got `'item2 undefined'` in an alert three times. But according to the explanation, I should have seen `'item3 undefined'`.

&gt; Note that when you run the example, `'item3 undefined'` is alerted three times! This is because just like previous examples, there is only one closure for the local variables for `buildList`. When the anonymous functions are called on the line `fnlist[j]();` they all use the same single closure, and they use the current value for `i` and `item` within that one closure (where `i` has a value of 3 because the loop had completed, and `item` has a value of `'item3'`).

Unless there’s something wrong with my browser, I don’t think that’s completely correct. Let’s look at the `buildList` function in depth.

`function buildList(list) {
`

Passing in a variable called `list` to the function.

&lt;pre&gt;`    var result = [];
`&lt;/pre&gt;

Just initiating an empty array.

&lt;pre&gt;`    for (var i = 0; i &lt; list.length; i++) {
`&lt;/pre&gt;

Here we have a standard `for` loop. But in JavaScript, you have to remember that the variable `i` gets hoisted to the top of the current scope (which in this case is the scope of the `buildList` function). So once this loop is done, we’ll still have access to `i`.

&lt;pre&gt;`        var item = 'item' + i;
`&lt;/pre&gt;

Creating a string using the word ‘item’ and the current value of `i`. I think this is where my confusion is coming from. More on that later.

&lt;pre&gt;`        result.push(function() {
            alert(item + ' ' + list[i])
        });
`&lt;/pre&gt;

Here’s where the fun closure stuff happens. We’re creating new functions and pushing them onto the `result` array. These functions are special because they have access to the enclosing function’s variables, like `list` and `i`. And they will still have access after `buildList` is done running—the variables are saved in a closure.

&lt;pre&gt;`    }
    return result;
}
`&lt;/pre&gt;

The array of functions is returned.

Calling `buildList([1, 2, 3])` and then each of the functions in `result` always yields `'item2 undefined'`. The `undefined` part makes sense, because at the end of the `for` loop, `i` increments one last time to `3`. So `i = 3` at the point in time when we call the functions in `result`. Since the input array `[1, 2, 3]` only has three elements, trying to access the fourth element at index `3` results in `undefined`.

As for why I’m seeing `'item2'` and not `'item3'`, I think that’s because the `item` string is set in this line:

&lt;pre&gt;`var item = 'item' + i;
</code></pre>
</div>

<p>Since the last time the code inside the loop is run is when <code class="highlighter-rouge">i = 2</code>, the <code class="highlighter-rouge">item</code> string is set to <code class="highlighter-rouge">'item2'</code>, not <code class="highlighter-rouge">'item' + i</code>. In other words, the <code class="highlighter-rouge">i</code> is evaluated at that point in time, and not later, when <code class="highlighter-rouge">i = 3</code>.</p>

<p>I hope this is correct! I would comment on the SO answer, but I don’t have that privilege yet.</p>

  </div>

</article>

    </div>
    <footer class="footer">
  <pre>{O.O}
(|||)
^  ^</pre>
</footer>
  </div>
</body>

</html>